graph LR
  linkStyle default fill:#ffffff

  subgraph diagram ["AI Code Agent - Containers"]
    style diagram fill:#ffffff,stroke:#ffffff

    2("<div style='font-weight: bold'>Azure DevOps</div><div style='font-size: 70%; margin-top: 0px'>[Software System]</div><div style='font-size: 80%; margin-top:10px'>Quell-Repo & Pull Requests.</div>")
    style 2 fill:#1168bd,stroke:#0b4884,color:#ffffff
    3("<div style='font-weight: bold'>GitHub</div><div style='font-size: 70%; margin-top: 0px'>[Software System]</div><div style='font-size: 80%; margin-top:10px'>Alternative: Quell-Repo &<br />Pull Requests.</div>")
    style 3 fill:#1168bd,stroke:#0b4884,color:#ffffff
    4("<div style='font-weight: bold'>Ollama</div><div style='font-size: 70%; margin-top: 0px'>[Software System]</div><div style='font-size: 80%; margin-top:10px'>Local LLM inference server</div>")
    style 4 fill:#1168bd,stroke:#0b4884,color:#ffffff
    5("<div style='font-weight: bold'>Claude API</div><div style='font-size: 70%; margin-top: 0px'>[Software System]</div><div style='font-size: 80%; margin-top:10px'>Anthropic's Claude LLM<br />service</div>")
    style 5 fill:#1168bd,stroke:#0b4884,color:#ffffff
    6("<div style='font-weight: bold'>OpenAI API</div><div style='font-size: 70%; margin-top: 0px'>[Software System]</div><div style='font-size: 80%; margin-top:10px'>OpenAI's GPT models</div>")
    style 6 fill:#1168bd,stroke:#0b4884,color:#ffffff

    subgraph 7 ["AI Code Agent"]
      style 7 fill:#ffffff,stroke:#0b4884,color:#0b4884

      14("<div style='font-weight: bold'>Orchestrator</div><div style='font-size: 70%; margin-top: 0px'>[Container: Steuert Workflow, Idempotenz, Retry/Backoff.]</div><div style='font-size: 80%; margin-top:10px'>Functions/Container</div>")
      style 14 fill:#438dd5,stroke:#2e6295,color:#ffffff
      19("<div style='font-weight: bold'>LLM Gateway</div><div style='font-size: 70%; margin-top: 0px'>[Container: Provider-agnostische Schnittstelle zu Sprachmodellen (LLM).]</div><div style='font-size: 80%; margin-top:10px'>Service</div>")
      style 19 fill:#438dd5,stroke:#2e6295,color:#ffffff
      24("<div style='font-weight: bold'>Adapter</div><div style='font-size: 70%; margin-top: 0px'>[Container: Azure DevOps integration]</div><div style='font-size: 80%; margin-top:10px'>Service</div>")
      style 24 fill:#438dd5,stroke:#2e6295,color:#ffffff
      29("<div style='font-weight: bold'>Eval Service</div><div style='font-size: 70%; margin-top: 0px'>[Container: Golden Tests, Metriken, Guardrails/Evals.]</div><div style='font-size: 80%; margin-top:10px'>Service</div>")
      style 29 fill:#438dd5,stroke:#2e6295,color:#ffffff
      30("<div style='font-weight: bold'>Vector Store</div><div style='font-size: 70%; margin-top: 0px'>[Container: Optional für RAG (Retrieval-Augmented Generation).]</div><div style='font-size: 80%; margin-top:10px'>DB</div>")
      style 30 fill:#438dd5,stroke:#2e6295,color:#ffffff
      31("<div style='font-weight: bold'>Telemetry/OTel Exporter</div><div style='font-size: 70%; margin-top: 0px'>[Container: Logs/Metriken/Traces (OTel = OpenTelemetry).]</div><div style='font-size: 80%; margin-top:10px'>Service</div>")
      style 31 fill:#438dd5,stroke:#2e6295,color:#ffffff
      32("<div style='font-weight: bold'>Key Vault</div><div style='font-size: 70%; margin-top: 0px'>[Container: Serverseitige Secrets/Keys; Zugriff via Managed Identity.]</div><div style='font-size: 80%; margin-top:10px'>Service</div>")
      style 32 fill:#438dd5,stroke:#2e6295,color:#ffffff
      8("<div style='font-weight: bold'>Webhook Service</div><div style='font-size: 70%; margin-top: 0px'>[Container: Empfängt Events (Kommentare/PR-Hooks) & validiert.]</div><div style='font-size: 80%; margin-top:10px'>Node/TypeScript</div>")
      style 8 fill:#438dd5,stroke:#2e6295,color:#ffffff
    end

    8-. "<div>validierte Events</div><div style='font-size: 70%'>[internal]</div>" .->14
    14-. "<div>Prompts/Tools</div><div style='font-size: 70%'>[internal]</div>" .->19
    14-. "<div>Eval (offline/online)</div><div style='font-size: 70%'>[internal]</div>" .->29
    14-. "<div>Kontextsuche (RAG)</div><div style='font-size: 70%'>[internal]</div>" .->30
    14-. "<div>PR erstellen/aktualisieren</div><div style='font-size: 70%'>[REST API]</div>" .->2
    14-. "<div>PR erstellen/aktualisieren</div><div style='font-size: 70%'>[REST API]</div>" .->3
    14-. "<div>Secrets/Token abrufen</div><div style='font-size: 70%'>[managed]</div>" .->32
    14-. "<div>Traces/Metriken/Logs</div><div style='font-size: 70%'>[OTel]</div>" .->31
    19-. "<div>Provider-Keys (serverseitig)</div><div style='font-size: 70%'>[managed]</div>" .->32
    29-. "<div>Eval-Metriken</div><div style='font-size: 70%'>[OTel]</div>" .->31
    19-. "<div>Generates code patches</div><div style='font-size: 70%'>[HTTP]</div>" .->4
    19-. "<div>Generates code patches</div><div style='font-size: 70%'>[HTTPS]</div>" .->5
    19-. "<div>Generates code patches</div><div style='font-size: 70%'>[HTTPS]</div>" .->6
    14-. "<div>Requests ADO operations</div><div style='font-size: 70%'>[HTTP]</div>" .->24
    24-. "<div>Creates branches, PRs,<br />comments</div><div style='font-size: 70%'>[REST API]</div>" .->2
    24-. "<div>Creates branches, PRs,<br />comments</div><div style='font-size: 70%'>[REST API]</div>" .->3
  end